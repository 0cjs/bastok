bastok - BASIC Tokenization Tools
=================================

This repository contains a detokenizer, written in Python, for [MSX-BASIC].
It should not be hard to extend to detokenize other Microsoft BASICs, or any
BASICs that use a similar tokenization format. A tokenizer is also planned,
but not currently available.

The primary aim of these tools is to help with reverse-engineering BASIC
programs, especially when dealing with historical and custom character
sets, but they may also be useful for people developing software in BASIC.

#### Files and directories

- `bin/detok`: A command-line detokenization tool. Given an input filename,
  it will read that as a tokenized BASIC file and print the detokenized
  version to stdout. Give the `-h` option for help.
- `Test`: A Bash script to set up a Python virtual environment and run the
  unit tests. Any parameters passed to this will be passed on to `pytest`.
- `pylib/bastok/`: A Python module containing the (de-)tokenization tools.


Character Sets
--------------

[MSX] machines use a character set with 256 code points. MSX-BASIC encodes
0x20 through 0xFF as a single byte containing the code point, and 0x00
through 0x1F as a 0x01 byte followed by the code point plus 0x40. (This
allows it to use bytes in the range 0x00 through 0x1F, excepting 0x01, as
control codes for cursor movement and the like.)

The standard character set for an MSX machine varies by region; details of
these can be found on the [MSX font][font and [MSX Characters and Control
Codes][codes] pages of the msx.org wiki. Programs may also define their own
character sets.

To support reading and editing MSX-BASIC programs, the detokenizer
translates MSX-encoded characters in string constants (both as quoted
arguments to BASIC keywords and functions and, whether explicitly quoted or
not, in `DATA` statements) and `REM` statements to Unicode. (These are
Python strings; the command-line tools encode the output as UTF-8.) Outside
of string constants and REM statements BASIC program text remains in ASCII
format.

You can see the list of currently known MSX character sets by by giving any
unknown charset name to the `-c` option of a command-line program, e.g.,
`bin/detok -c - -`.

To support program-defined character sets, it's planned to add the ability
to use user-supplied translation tables.

Support for programs that use kanji ROM characters needs to be investigated.


Support
-------

Contact the author, Curt Sampson (usually known as 'cjs') if you have
questions, comments, feature requests, or just want help using this. If you
are on The MSX Channel server on [Discord], I am there; otherwise you can
try a private message to `cjs_cynic` on [Telegram], `0cjs` on [Gitter] or
`cjs#6537` on Discord. You may also send email to <cjs@cynic.net>, but text
chat is the preferred way of contacting me.


Caveats and Todo Items
----------------------

* The only charset currently implemented is `ja`, MSX2 Japanese. `int`
  (International) has about 70 code points that do not yet have
  corresponding Unicode characters assigned (see disabled tests in
  `pylib/bastok/msxchars.pt` and the code in the `bastok.msxchars` module).
  These should not be difficult to add for someone familiar with this
  charset and its multilingual use.

* Some programs created with tools other than the MSX BASIC interpreter may
  use binary data, including invalid encoding sequences, in string
  constants and/or REM statements. (This is often to embed binary data or
  machine-language routines into the BASIC program.) Currently bastok does
  not handle this, and how best to handle this is not yet clear. Having
  some examples of large programs that do this would help.

* To assist reverse-engineering, it's planned to add support for a
  multi-line format for the source files generated by the detokenizer and
  processed by the tokenizer, allowing one to place `:`-separated
  statements on separate lines, add comments not inserted into the
  tokenized version of the program, and "compression" (to remove
  unnecessary spaces, etc.) when tokenizing.



<!-------------------------------------------------------------------->
[codes]: https://www.msx.org/wiki/MSX_Characters_and_Control_Codes
[font]: https://www.msx.org/wiki/MSX_font
[msx-basic]: https://en.wikipedia.org/wiki/MSX_BASIC
[msx]: https://en.wikipedia.org/wiki/MSX

[discord]: https://discord.com
[gitter]: https://gitter.im
[telegram]: https://telegram.org
